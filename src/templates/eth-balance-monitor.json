{
  "id": "eth-balance-monitor-topup",
  "name": "ETH Balance Monitor with Auto Top-up",
  "description": "Monitor ETH wallet balance on a schedule and automatically transfer funds when balance drops below threshold",
  "category": "monitoring",
  "useCase": "Automatically maintain minimum ETH balance in a wallet by transferring funds from a funding wallet when the balance drops below a threshold. Useful for keeping smart contract wallets, bot wallets, or operational wallets funded.",
  "difficulty": "beginner",
  "tags": ["ethereum", "balance", "monitoring", "automation", "wallet-management"],
  "requiredPlugins": ["web3", "sendgrid"],
  "estimatedSetupTime": 5,
  "nodes": [
    {
      "id": "schedule-trigger",
      "type": "trigger",
      "pluginType": "schedule",
      "position": { "x": 100, "y": 200 },
      "config": {
        "cronExpression": "0 */4 * * *",
        "description": "Check every 4 hours"
      },
      "label": "Schedule Trigger"
    },
    {
      "id": "check-balance",
      "type": "step",
      "pluginType": "web3",
      "stepSlug": "check-balance",
      "position": { "x": 300, "y": 200 },
      "config": {
        "network": "ethereum",
        "address": "{{env.MONITORED_WALLET_ADDRESS}}"
      },
      "label": "Check ETH Balance"
    },
    {
      "id": "balance-condition",
      "type": "condition",
      "position": { "x": 500, "y": 200 },
      "config": {
        "conditions": [
          {
            "field": "{{check-balance.balance}}",
            "operator": "<",
            "value": "{{env.MIN_BALANCE_ETH}}"
          }
        ]
      },
      "label": "Balance < Threshold?"
    },
    {
      "id": "transfer-funds",
      "type": "step",
      "pluginType": "web3",
      "stepSlug": "transfer-funds",
      "position": { "x": 700, "y": 150 },
      "config": {
        "network": "ethereum",
        "amount": "{{env.TOPUP_AMOUNT_ETH}}",
        "recipientAddress": "{{env.MONITORED_WALLET_ADDRESS}}"
      },
      "label": "Transfer ETH Top-up"
    },
    {
      "id": "send-success-email",
      "type": "step",
      "pluginType": "sendgrid",
      "stepSlug": "send-email",
      "position": { "x": 900, "y": 150 },
      "config": {
        "to": "{{env.ALERT_EMAIL}}",
        "subject": "Wallet Top-up Successful",
        "content": "Transferred {{env.TOPUP_AMOUNT_ETH}} ETH to {{env.MONITORED_WALLET_ADDRESS}}. Transaction: {{transfer-funds.transactionHash}}"
      },
      "label": "Send Success Email"
    },
    {
      "id": "send-failure-email",
      "type": "step",
      "pluginType": "sendgrid",
      "stepSlug": "send-email",
      "position": { "x": 900, "y": 250 },
      "config": {
        "to": "{{env.ALERT_EMAIL}}",
        "subject": "Wallet Top-up Failed",
        "content": "Failed to transfer ETH. Error: {{transfer-funds.error}}. Monitored wallet: {{env.MONITORED_WALLET_ADDRESS}} has balance: {{check-balance.balance}} ETH"
      },
      "label": "Send Failure Email"
    },
    {
      "id": "log-healthy",
      "type": "step",
      "pluginType": "webhook",
      "stepSlug": "send-webhook",
      "position": { "x": 700, "y": 300 },
      "config": {
        "url": "{{env.LOGGING_WEBHOOK_URL}}",
        "method": "POST",
        "body": {
          "status": "healthy",
          "balance": "{{check-balance.balance}}",
          "threshold": "{{env.MIN_BALANCE_ETH}}",
          "timestamp": "{{$now}}"
        }
      },
      "label": "Log Healthy Status"
    }
  ],
  "edges": [
    {
      "id": "e1",
      "source": "schedule-trigger",
      "target": "check-balance"
    },
    {
      "id": "e2",
      "source": "check-balance",
      "target": "balance-condition"
    },
    {
      "id": "e3",
      "source": "balance-condition",
      "target": "transfer-funds",
      "condition": "true"
    },
    {
      "id": "e4",
      "source": "balance-condition",
      "target": "log-healthy",
      "condition": "false"
    },
    {
      "id": "e5",
      "source": "transfer-funds",
      "target": "send-success-email",
      "condition": "{{transfer-funds.success}}"
    },
    {
      "id": "e6",
      "source": "transfer-funds",
      "target": "send-failure-email",
      "condition": "{{!transfer-funds.success}}"
    }
  ]
}
